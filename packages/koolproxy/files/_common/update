#!/bin/sh                                                                                                         
                                                                                                                  
VIDEO_REMOTE="http://entware.mirrors.ligux.com/koolproxy/1.dat"                                                   
RULES_REMOTE="http://entware.mirrors.ligux.com/koolproxy/koolproxy.txt"                                           
MOBILE_REMOTE="https://coding.net/u/Carseason/p/koolproxy/git/blob/master/koolproxy_wp.txt"                       
                                                                                                                  
RULES_PATH="/usr/share/koolproxy/data"                                                                            
RULES_LOCAL="${RULES_PATH}/koolproxy.txt"                                                                         
VIDEO_LOCAL="${RULES_PATH}/1.dat"                                                                                 
MOBILE_LOCAL="${RULES_PATH}/koolproxy_wp.txt"                                                                     
                                                                                                                  
if [ -f "$VIDEO_LOCAL" ]; then                                                                                    
        echo "updating rules of video"                                                                            
        rm $VIDEO_LOCAL                                                                                           
fi                                                                                                                
wget -c -q $VIDEO_REMOTE -P $RULES_PATH                                                                           
                                                                                                                  
if [ -f "$RULES_LOCAL" ]; then                                                                                    
        echo "updating rules of koolproxy"                                                                        
        rm $RULES_LOCAL                                                                                           
fi                                                                                                                
wget -c -q $RULES_REMOTE -P $RULES_PATH                                                                           
                                                                                                                  
if [ -f "$MOBILE_LOCAL" ]; then                                                                                   
        echo "updating rules of koolproxy mobile"                                                                 
        rm $MOBILE_LOCAL                                                                                          
fi                                                                                                                
wget -c -q $MOBILE_REMOTE -P $RULES_PATH --no-check-certificate                                                   
                                                                                                                  
if [ $? -eq 0 ]; then                                                                                             
        echo "restarting koolproxy"                                                                               
        /etc/init.d/koolproxy restart                                                                             
else                                                                                                              
        echo "update failed"                                                                                      
fi   
